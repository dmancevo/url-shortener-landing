---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Get all blog posts, filter out drafts, and sort by date
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout
  title="Blog - URL Shortener API"
  description="Learn about URL shortening, A/B testing, analytics, and best practices for link management."
>
  <main class="container" style="padding: 4rem 1.5rem;">
    <div style="max-width: 800px; margin: 0 auto;">
      <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--text);">Blog</h1>
      <p style="font-size: 1.125rem; color: var(--text-light); margin-bottom: 3rem;">
        Insights on URL shortening, A/B testing, analytics, and link management best practices.
      </p>

      <div style="display: flex; flex-direction: column; gap: 2rem;">
        {posts.map((post) => (
          <article style="border: 1px solid var(--border); border-radius: 0.5rem; padding: 1.5rem; background: var(--bg); transition: transform 0.2s, box-shadow 0.2s;">
            <a href={`/blog/${post.slug}`} style="text-decoration: none; color: inherit;">
              <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text);">
                {post.data.title}
              </h2>
              <div style="display: flex; gap: 1rem; margin-bottom: 0.75rem; color: var(--text-light); font-size: 0.875rem;">
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
                <span>â€¢</span>
                <span>{post.data.author}</span>
              </div>
              <p style="color: var(--text-light); line-height: 1.6;">
                {post.data.description}
              </p>
              {post.data.tags && post.data.tags.length > 0 && (
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                  {post.data.tags.map((tag) => (
                    <span style="background: var(--bg-alt); padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; color: var(--text-light);">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </a>
          </article>
        ))}
      </div>

      {posts.length === 0 && (
        <p style="text-align: center; color: var(--text-light); padding: 3rem 0;">
          No blog posts yet. Check back soon!
        </p>
      )}
    </div>
  </main>

  <style>
    article:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    article:hover h2 {
      color: var(--primary);
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem !important;
      }
    }
  </style>
</Layout>
